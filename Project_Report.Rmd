---
output: 
  html_document:
    toc: true
    toc_float: true
---
# **Project Report for P8105**
#### *By Brittany Shea | Erfan Faridmoayer| Niharika Telrandhe| Pooja Desai | Sabah Usmani*

## **Project Motivation**

Throughout the course of the COVID-19 pandemic, vaccine availability played a significant role in reduction of new cases, while reducing symptom severity among people who were infected. With the rise of new variants, the need for booster vaccinations with new COVID strain coverage was evident. 

There were widespread reports of lack of vaccine availability in many areas, especially among those with lower socioeconomic status and limited geographic resource availability. 

Given these reports, we wanted to explore the following -

1. Factors that make neighborhoods in NYC vulnerable.
2. Trends in vaccination - how people are vaccinated - fully (FDA approved primary series) , partially( 1-dose of FDA approved primary series)  or with booster (1 complete FDA-approved primary series + additional boosters).
3. How many people are actually getting vaccinated?
COVID-19 vaccination and booster distribution by zip codes and boroughs in NYC as of 2022.
4. Disparities in vaccine distribution with respect to geographic location, poverty status, education attainment and median income.
5. Sociodemographic trends in individuals receiving complete vaccinations and boosters.

### *Related Work*

The `ggplot function` in R combined with the [New York City COVID-19 geographic mapping](https://www.nyc.gov/site/doh/covid/covid-19-data.page) found here was the inspiration for us to further evaluate the trends in vaccine and booster distribution across New York City based on the available zip codes.

## **Initial Questions**
Q1. What socio-demographic and geographic factors make a neighborhood vulnerable with respect to COVID-19 vaccination and boosters.

Q2. How many people were vaccinated - partially, fully and with boosters?

Q3. How education attainment, poverty status, median income was affecting vaccination and booster distribution in NYC.

Q4.Vaccination and booster distribution with respect to zip codes in NYC.

### *Roadblocks & General Difficulties*

</center>

<img src="images/roadblock.jpg">

#### **Roadblock 1.** Zip codes vary! We realized zip codes are not the best or most reliable way to define boundaries and that they were available in a variety of formats. Not all datasets had the MODZTAs available.
#### **Trouble-shooting** We went ahead and used the modified zipcode tabulated areas of MODZTAs and you can find more information about it linked in the data sources below.


#### **Roadblock 2.** We were unable to analyze booster uptake and distributions before 9th March 2022. The NYC COVID data only added a column called `count_additional` which was a count of everyone who received a completed FDA-approved primary series plus additional boosters for people aged 18+ in NYC.The data did not clearly record the initial booster rollouts for priority population before it was approved for all above 18.
#### **Trouble-shooting** We restricted our vaccination and booster data from 9th March 2022 onwards  (approximately 90 days after the booster was approved for 18+) as well as poverty status and median income in the past 12 months only to keep our analysis fresh and updated.

#### **Roadblock 3** We were unable to find complete, reliable data for our demographic variables of interest (education status, median income, poverty status) for the same year as our vaccine data (2022). 
#### **Trouble-shooting** We opted to use census data from 2020 to provide and understanding of popoulation demographics with regards to these variabales. Through there were slight differences in total populations counts, we continued with this data with the assumption that variation would be similarly distributed across all neighborhoods.


### *Evolution of Analytic Questions* 

After cleaning the data our focus shifted from the initial analysis to the following:-

Q1. How does education attainment, poverty status in the past 12 months and median income in the past 12 months affect the vaccine and booster distribution in NYC by MODTZAs and boroughs.

Q2. How many people were vaccinated - partially, fully and with boosters post 9th March 2022 by boroughs and zipcodes?

Q3. The vaccination and booster status of the proportion of individuals aged 18+ who were below the poverty level by boroughs.

Q4. How did the recent booster rollout look in NYC - the big picture.

## **Data** 

### *Data Sources*
We used [NYC Department of Health Coronavirus Data website](https://www.nyc.gov/site/doh/covid/covid-19-data.page) and [GitHub Data Repository](https://github.com/nychealth/coronavirus-data):This repository contains information on COVID-19 vaccination and booster reporting across the five boroughs, updated daily, aggregated at modified zipcode tabulation areas.

Details about MODZTA can be found [here](https://nychealth.github.io/covid-maps/modzcta-geo/about.html) and the [GitHub Repository](https://github.com/nychealth/coronavirus-data/tree/master/Geography-resources).

Along with this we used four datasets from [US Census Bureau](https://data.census.gov) to construct our analysis of socioeconomic and demographic variables.We used the New York State census data and merged them using the NYC MODZTA.

1. [Total population](https://data.census.gov/table?q=P1&tid=DECENNIALPL2020.P1)

2. [Education Attainment](https://data.census.gov/table?q=S1501&tid=ACSST1Y2021.S1501)

3. [Poverty Status in the past 12 months](https://data.census.gov/table?q=S1701)

4. [Median Income in the past 12 months](https://data.census.gov/table?q=S1903)

### *Data Cleaning*

1. MODZTA and Vaccination Coverage 
2. Total Population
3. Education Attainment
4. Poverty Status
5. Median income

## **Exploratory Data Analysis**
```{r setup, include = FALSE}
library (tidyverse)
library (readxl)
library(plotly)
library(esquisse)


knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

## **1. The Vaccination Coverage in NYC by Zipcode and Boroughs**

```{r, include=FALSE}
merged_vaccine_data = read_csv(file="./data/merged_vaccine_data.csv")
```

### Fully Vaccinated Individuals by Zipcode and Boroughs:
```{r, echo=FALSE}
ggplot(merged_vaccine_data) +
  aes(
    x = modzcta,
    y = count_Fully_prop,
    colour = borough
  ) +
  geom_point(shape = "circle", size = 1.5) +
  scale_color_hue(direction = 1) +
  labs(
    x = "Zip Codes",
    y = "Proportion of Fully Vaccinated Individuals",
    title = "Proportion Fully Vaccinated Individuals in each Zipcode across Boroughs",
    subtitle = "(The horizontal line at 1 indicates 100% have received 2 doses of an FDA-approved Primary Vaccine series)",
    color = "Boroughs"
  ) +
  theme_minimal() + geom_hline(yintercept=1, linetype="solid",  color = "navy", size=0.5)
```

### Additional/Booster Vaccinated Individuals by Zipcode and Boroughs:
```{r, echo=FALSE}
ggplot(merged_vaccine_data) +
  aes(
    x = modzcta,
    y = count_Additional_prop,
    colour = borough
  ) +
  geom_point(shape = "circle", size = 1.5) +
  scale_color_hue(direction = 1) +
  labs(
    x = "Zip Codes",
    y = "Proportion of  Booster Vaccinated Individuals",
    title = "Proportion of Booster Vaccinated Individuals in each Zipcode across Boroughs",
    subtitle = "(The horizontal line at 1 indicates 100% have received a booster)",
    color = "Boroughs"
  ) + theme_minimal() + geom_hline(yintercept=1, linetype="solid",  color = "navy", size=0.5)
```

## **2. The Education Attainment in NYC by Vaccination Status and Boroughs**
```{r, include=FALSE}
cleaned_edu_booster_dataset = read_csv(file="./data/cleaned_edu_booster_dataset.csv")
```

### Fully Vaccinated Individuals by Education Status and Age
``` {r, echo = FALSE}
ggplot(cleaned_edu_booster_dataset) +
  aes(x = edu_prop, y = fully_vaccinated_prop, colour = edu) +
  geom_point(shape = "circle", size = 1.5) +
  scale_color_hue(direction = 1) +
  labs(
    x = "Proportion of Individuals by Education Status",
    y = "Proportion of Fully Vaccinated Individuals ",
    title = "Fully Vaccinated Individuals by Education Status and Age",
    color = "Education Status"
  ) +
  theme_minimal() +
  facet_wrap(vars(age))
```

### Additional/Booster Individuals by Education Status and Age
``` {r, echo=FALSE}
ggplot(cleaned_edu_booster_dataset) +
  aes(x = edu_prop, y = booster_prop, colour = edu) +
  geom_point(shape = "circle", size = 1.5) +
  scale_color_hue(direction = 1) +
  labs(
    x = "Proportion of Individuals by Education Status",
    y = "Proportion of Individuals Boosted ",
    title = "Booster Individuals by Education Status and Age",
    color = "Education Status"
  ) +
  theme_minimal() +
  facet_wrap(vars(age))
```

### Fully Vaccinated Individuals by Education Status and Boroughs
```{r, echo = FALSE}
ggplot(cleaned_edu_booster_dataset) +
  aes(x = edu_prop, y = fully_vaccinated_prop, colour = borough) +
  geom_point(shape = "circle", size = 1.5) +
  scale_color_hue(direction = 1) +
  labs(
    x = "Education Status",
    y = "Proportion of individuals fully vaccinated",
    title = "Fully vaccinated individuals by Education Status and Borough",
    color = "Boroughs"
  ) +
  theme_minimal() +
  facet_wrap(vars(edu))
```

### Additional/Booster Individuals by Education Status and Boroughs
```{r, echo=FALSE}
ggplot(cleaned_edu_booster_dataset) +
  aes(x = edu_prop, y = booster_prop, colour = borough) +
  geom_point(shape = "circle", size = 1.5) +
  scale_color_hue(direction = 1) +
  labs(
    x = "Education Status",
    y = "Proportion of individuals receiving boosters",
    title = "Additional/Booster individuals by Education Status and Borough",
    color = "Boroughs"
  ) +
  theme_minimal() +
  facet_wrap(vars(edu))

```

## **3. The Median Income vs Vaccination and Booster Coverage**

```{r income_data_preprocessing, paged.print=TRUE,include=FALSE}
#Loading income data 
incomedata <- read_csv("data/median_income.csv", skip = 1)

#Loading zipcode data 
zipcode_data <- read.csv("data/Modified_Zip_Code_Tabulation_Areas__MODZCTA_.csv")

incomedata_clean <- incomedata %>%  
  janitor::clean_names()  %>%
  select(geography, geographic_area_name, estimate_median_income_dollars_families_families, estimate_median_income_dollars_nonfamily_households_nonfamily_households) %>%
  rename (median_income_nonfamily = estimate_median_income_dollars_nonfamily_households_nonfamily_households, median_income_family = estimate_median_income_dollars_families_families) %>% 
  separate(geographic_area_name, c('delete', 'modzcta')) %>% 
  select(modzcta, median_income_family, median_income_nonfamily)

vaccine_data <- read.csv("data/coverage_by_modzcta_adults.csv") %>%
  janitor::clean_names() %>%
  mutate(modzcta = as.character(modzcta))

vaccine_data$modzcta <- gsub('\\s+', '', vaccine_data$modzcta)

```

```{r merege-dataset,include=FALSE}
joined_dataset_income = merge(vaccine_data,incomedata_clean, by = "modzcta", all.x = TRUE)
```

```{r,echo=FALSE, include = FALSE}
#Cleaning variables in joined data and changing into the correct variable type 

income_zip_clean <- joined_dataset_income %>%
  mutate(modzcta = as.numeric(modzcta), median_fam = as.numeric(median_income_family), median_nonfam = as.numeric(median_income_nonfamily)) %>% 
  mutate(median_fam = if_else(is.na(median_fam), 250000, median_fam)) %>% 
  filter(!is.na(median_nonfam)) %>% 
  select(modzcta, pop_denominator, count_partially_cumulative, count_fully_cumulative, count_1plus_cumulative, count_additional_cumulative, median_fam, median_nonfam, borough) %>% 
  mutate(Count_partially_prop = round(count_partially_cumulative/pop_denominator,2), Count_Fully_prop = round(count_fully_cumulative/pop_denominator,2), Count_1Plus_prop = round(count_1plus_cumulative/pop_denominator,2), Count_Additional_prop = round(count_additional_cumulative/pop_denominator,2), income_average = ((median_fam + median_nonfam)/2))

str(income_zip_clean)

```

### Fully Vaccinated Individuals by Median Household Income and Boroughs
```{r,echo=FALSE}

#GGPLOT of Vaccination combined median income and non family median income by borough

income_zip_clean %>%
    ggplot() +
    geom_point(aes(x = income_average, y=Count_Fully_prop, color=borough), alpha = 0.5)+
  labs(
   title = "Proportion Vaccinated & Median Household Income by Borough", 
    x = "Median Household Income", 
    y = "Proportion Vaccinated (Count_Fully_Prop)")


```

### Additional/Booster Vaccinated Individuals by Median Household Income and Boroughs
```{r,echo=FALSE}

income_zip_clean %>%
    ggplot() +
    geom_point(aes(x = income_average, y=Count_Additional_prop, color=borough), alpha = 0.5)+
  labs(
   title = "Proportion Boosted & Median Household Income by Borough", 
    x = "Median Household Income ", 
    y = "Proportion Boosted (Count_Additional_Prop)")


```

### **4. Poverty Status vs Vaccination and Booster Coverage**

```{r, echo=FALSE}
data <- read.csv("data/poverty_status.csv", skip = 1) %>%
  janitor::clean_names()

dataset_clean = data %>% 
  mutate(modzcta = substr(geographic_area_name,6,11),
         total_pop_pov_det_18_and_over = estimate_total_population_for_whom_poverty_status_is_determined - estimate_total_population_for_whom_poverty_status_is_determined_age_under_18_years) %>% 
  mutate(below_pov_level_pop_pov_det_18_and_over = estimate_below_poverty_level_population_for_whom_poverty_status_is_determined - estimate_below_poverty_level_population_for_whom_poverty_status_is_determined_age_under_18_years) %>%
  select(modzcta, total_pop_pov_det_18_and_over, below_pov_level_pop_pov_det_18_and_over)

```

```{r, echo=FALSE}
dataset_clean = dataset_clean %>% 
  mutate(prop_below_pov_level_18_and_over = below_pov_level_pop_pov_det_18_and_over / total_pop_pov_det_18_and_over)
```

```{r, echo=FALSE}
zipcode_data <- read.csv("data/Modified_Zip_Code_Tabulation_Areas__MODZCTA_.csv")
```

```{r Load zipcode data, echo=FALSE}
vaccine_data <- read.csv("data/coverage_by_modzcta_adults.csv") %>%
  janitor::clean_names() %>%
  mutate(modzcta = as.character(modzcta))

vaccine_data$modzcta <- gsub('\\s+', '', vaccine_data$modzcta)
dataset_clean$modzcta <- gsub('\\s+', '', dataset_clean$modzcta)
```

```{r, include=FALSE}
joined_dataset_poverty = merge(vaccine_data,dataset_clean, by = "modzcta", all.x = TRUE)
```

```{r, include = FALSE}
joined_dataset_poverty = joined_dataset_poverty %>% 
  mutate(
  prop_partially = count_partially_cumulative / pop_denominator,
    prop_fully = count_fully_cumulative / pop_denominator,
    prop_booster = count_additional_cumulative / pop_denominator
  )
```

### Fully Vaccinated Individuals by determined Poverty Status Aged 18+
```{r echo=FALSE}
joined_dataset_poverty %>% 
  ggplot(aes(x = prop_below_pov_level_18_and_over, y = prop_fully, color = borough)) +
  geom_point()+
  labs(
   title = "Fully Vaccinated Individuals by determined Poverty Status Aged 18+", 
    x = "Fully Vaccinated Individuals ", 
    y = "Poverty Status Aged 18+")

```

### Additional/Booster Vaccinated Individuals by determined Poverty Status Aged 18+
```{r, echo=FALSE}
joined_dataset_poverty %>% 
  ggplot(aes(x = prop_below_pov_level_18_and_over, y = prop_booster, color = borough)) +
  geom_point()+
  labs(
   title = "Additional/Booster Vaccinated Individuals by determined Poverty Status Aged 18+", 
    x = "Additional/ Boosted Indidivuals ", 
    y = "Poverty Status Aged 18+")

```

### Proportion of Adults aged 18+ with determined Poverty Status by Boroughs
```{r, echo=FALSE}
joined_dataset_poverty %>% 
  ggplot(aes(x = prop_below_pov_level_18_and_over, y = borough, color = borough)) +
  geom_point()+
  labs(
   title = "Proportion of Adults aged 18+ with determined Poverty Status by Boroughs", 
    x = "Poverty Status Aged 18+ ", 
    y = "Boroughs")

```






## **Discussion**

### *Key Findings*

### *Were the Findings as Expected?*

### *What insights into the data did we make?*

### *Suggestions/Recommendations for further Research and Analysis of this topic.*


